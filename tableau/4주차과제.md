# Fourth Study Week

- 30강: [계층](#30-계층)

- 31강: [집합](#31-집합)

- 32강: [결합집합](#32-결합집합)

- 33강: [계산된 필드](#33-계산된-필드)

- 34강: [행수준계산](#34-행수준계산)

- 35강: [집계계산](#35-집계계산)

- 36강: [테이블계산](#36-테이블계산)

- 37강: [퀵테이블계산(1)](#37-퀵테이블계산1)

- 38강: [퀵테이블계산(2)](#38-퀵테이블계산2)

- [문제1](#문제-1)

- [문제2](#문제-2)

- [문제3](#문제-3)

## Study Schedule

| 강의 범위     | 강의 이수 여부 | 링크                                                                                                        |
|--------------|---------|-----------------------------------------------------------------------------------------------------------|
| 1~9강        |  ✅      | [링크](https://www.youtube.com/watch?v=AXkaUrJs-Ko&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=84)       |
| 10~19강      | ✅      | [링크](https://www.youtube.com/watch?v=AXkaUrJs-Ko&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=75)       |
| 20~29강      | ✅      | [링크](https://www.youtube.com/watch?v=AXkaUrJs-Ko&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=65)       |
| 30~38강      | ✅      | [링크](https://youtu.be/e6J0Ljd6h44?si=nhGbB7GsdOCqj15f)       |
| 39~49강      | 🍽️      | [링크](https://www.youtube.com/watch?v=AXkaUrJs-Ko&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=45)       |
| 50~59강      | 🍽️      | [링크](https://www.youtube.com/watch?v=AXkaUrJs-Ko&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=35)       |
| 60~69강      | 🍽️      | [링크](https://www.youtube.com/watch?v=AXkaUrJs-Ko&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=25)       |
| 70~79강      | 🍽️      | [링크](https://www.youtube.com/watch?v=AXkaUrJs-Ko&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=15)       |
| 80~89강      | 🍽️      | [링크](https://www.youtube.com/watch?v=AXkaUrJs-Ko&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=5)        |

<!-- 여기까진 그대로 둬 주세요-->

> **🧞‍♀️ 오늘의 스터디는 지니와 함께합니다.**


## 30. 계층
- view에서 값을 drill&down해 값을 세부적으로 찾을 때 유용한 방법.    
- 날짜 별로 매출 보기 실습   
매출 필드 > 마크 카드 텍스트에 드래그 / 배송 날짜 필드 > 행선반    

-실습
1. 위치필드 마우스 우클릭해 계층 제거 선택 > 해당 계층 해제      
2. 두 필드(국가/지역, 도시) 선택 후 마우스 우클릭 > 계층 > 계층 만들기 >> 이름 : 위치   
3. 나머지 필드들(지역)을 계층으로 드래그   
4. 지역별 매출 보기 ; 지역 > 행선반 / 매출 > 텍스트 마크로 // 드릴다운만으로 지역별, 시도별 매출 확인 가능 


## 31. 집합
 - 데이터를 표시하는 방법
 - 사용자가 직접 어떤 조건을 설정하고 그 조건을 기반으로 데이터를 구분하는 방법   
 - 실습    
 수익을 많이 낸 상위 10개 도시 표현   
 1. 위치 계층에 "시/도" 필드 > 행선반 / 수익 > 텍스트 마크 카드로   
 2. 내림차순 정리    
 3. 시/도 필드 우클릭 > 만들기 > 집합 > 상위 탭 > 필드기준    
 4. 해당 집합 > 색상 마크 카드로   

## 32. 결합집합
- 두가지의 집합 사용 방법   
- 실습    
매출이 5만원 이상 & 수익률이 10% 이상인 도시 데이터 구분 
1. 매출 5만원 이상 집합 만들기   
시/도 필드 > 만들기 > 집합 > 조건 > 필드기준 > 매출 > 이상 클릭, 5만   
2. 수익률 10% 이상 집합 만들기 
시/도 필드 > 만들기 > 집합 > 조건 > 필드기준 > 수익률 > 0.1 이상 클릭    
3. 수익률, 매출 > 텍스트 마크로 / 생성 집합 > 색상 마크로 (생성 집합 확인)   
4. 집합 결합
  2번 집합 우클릭 > 결합된 집합 만들기 > 만든 집합 클릭 > 옵션 4가지 중 고르기.   





## 33. 계산된 필드
- 데이터 원본에 있는 필드를 활용하여 새로운 필드 만들기 
- 기존 데이터 이외에 계산해야 할 데이터가 추가로 필요한 경우
- 3가지 방법 
1. 데이터 패널 > 계산된 필드 만들기
2. 분석 탭 > 계산된 필드 만들기
3. 사용하고자 하는 필드 마우스 우클릭 > 만들기 > 계산된 필드  

- 필드 입력 방법
1. 해당 필드를 드래그 앤 드랍
2. 입력창에 필드 이름 입력 (대괄호 안에 필드 이름 입력)   

- 실습 (제품별로 어느정도 수익 냈는지 ; 백분율)
1. 데이터 패널 역삼각형 > 계산된 필드 만들기 > 이름:수익률 > 계산식 입력 (sum([수익])/sum([매출]))    
2. 수익률 필드 마우스 우클릭 > 기본속성 > 백분율 
3. 제품 이름 > 행선반 / 수익률 > 텍스트 마크 카드 >> 데이터 확인   



## 34. 행수준계산
- 계산된 필드에서 데이터 계산하는 방법 
- 기본 계산    
-데이터 원본에 대한 행수준 계산 또는 집계 계산.    
-행 수준 계산을 데이터의 각 레코드를 통해 계산하는 방식 (ex. 수익을 매출로 나눈 항목별 레코드를 다 합계한 계산식)
-집계 계산 : 현재 뷰에서 보이는 기준으로 계산하는 방식 (ex.전체 수익을 전체 매출로 나눔) 

- 행 수준 계산 실습 (고객 이름 > 성과 이름 분리)
1. 데이터 패널 > 계산된 필드 만들기 > 이름 : 고객 이름(분리) > 계산식 : split([고객 이름], ' ', 1)
2. 고객 이름(분리), 고객 이름 > 행선반 
 
- IFTHEN    
IF[수익] > 0 THEN '수익성 있음'
ELSEIF [수익] < 0 THEN '수익성 없음' 
ELSE '손익 평형' 
END   
=> 수익성이 있는가 없는가    

- DATEDIFF
datediff(날짜_부분, 시작_날짜, 끝_날짜 [주_시작])      
주문 날짜 필드 > 우클릭 > 사용자 지정 > 연도/월/일 클릭 
배송 날짜도 똑같이 변경!!   

(새로운집합)주문 처리 일수 필드 > 마우스 우클릭 > 차원값으로 변경(측정값에서..!)    
- 테이블 계산 
- LOD 표현식 

## 35. 집계계산
- 현재 뷰에서 보이는 기준으로 계산하는 방식   
- 테블로는 뷰에서 필드 레벨에 따라 해당 레벨에 관련된 레코드를 통해 계산해서 원한 값을 반환해서 데이터 확인   
- 기본 집계 계산 설정 변경 방법
-필드에 마우스 우클릭 > 기본 속성 > 집계 > 원하는 집계 선택 가능  

- 합계 매출 집계 계산   
계산 공간 ; sum([매출]) 입력   
제조업체 필드, 생성된 필드, "매출" 필드 더블 클릭 > 측정값 선반에 두  필드들 사이 차이 확인 가능   
만든 필드 < 집계 표시 o / 마우스 우클릭 > 집계 변경 불가    
자동 필드 < "합계" 표시 o / 마우스 우클릭 > 집계 변경 가능     

- 집계 계산 실습 (연도별 주문건수)   
1. 계산된 필드 > COUNTD([주문ID]) 
2. 생성 필드 > 행선반 / "주문 날짜" > 열선반  >> 각 연도마다 주문건수 확인 가능   


## 36. 테이블계산
- 뷰에 보이는 내용을 바탕으로 데이터가 계산됨   
- 실습 
1. 주문날짜 필드, 매출 필드 더블클릭 > 주문날짜 > 행선반으로 > 분기와 월 필드만 남김 
2. 사용 가능 함수 보는 법 : 
계산된 필드 만들기 > 드롭다운 메뉴 > 테이블 계산 선택    
3. 누적 매출 보는법 : runnig_sum(sum([매출]))  
4. 확인하는 법 : 생성된 매출 > 텍스트 마크 카드 위에 드래그    

- 계산 방향 변경법
1. 해당 필드 마우스 우클릭 > 다음을 사용하여 계산 > 여러가지 계산 방향 중 하나 고르기 
2. 테이블 계산 된 필드 마우스 우클릭 > 테이블 계산 편집 > 계산 방향 선택 가능, 계산 옵션 추가 가능    



## 37. 퀵테이블계산(1)
- 퀵테이블 계산 : 테이블 계산에서 가장 자주 쓰이는 애들을 클릭으로 활용 가능하게 만든 것.   
- 작동 방식    
  사용하고자 하는 필드 마우스 우클릭 > 퀵 테이블 계산 
- 계산 유형 실습 
- 분기별 누적 매출 & 월별 매출 차트(누계 활용)   
1. 주문 날짜 필드 마우스 우클릭 > 열선반 > "필드놓기" 창 > 연속형 "분기(주문 날짜)" 더블 클릭 / 매출 > 행선반
2. 행선반 매출 복제 > 매출 > 퀵테이블 > 누계 (세모 표시 생김)
3. 그래프 왼쪽 우클릭 > 이중축  

- 연도별 매출 차이(퀵테이블 차이 : 측정값이 기준값과 활용)    
1. 주문 날짜 > 열선반 / 범주 > 행선반 / 매출 > 텍스트 마크카드    
2. 매출 필드 마우스 우클릭 > 퀵테이블 계산 > 차이 선택 
3. 차이 ; 기준 > '이전' 기본 설정 옵션 선택 가능 

 - 비율 차이 : 측정값들 사이의 성장률  
- 월별 수익 차트 (%)
1. 주문 날짜 마우스 우클릭 > 열선반 >  연속형 "월(주문날짜") 더블클릭 / 수익필드 > 행선반 > 기호클릭 > 퀵테이블 계산 > 비율 차이 
2. 마크에서 그래프 형식 변경 
3. 행선반 수익 컨트롤 누른 채 > 색상 위로 끌어다 놓음.   
4. 색상 편집 > 단계별 색상 > 2단계  

- 구성비율(지역별 제품 매출 순위와 구성 비율)   
1. 지역, 범주 필드 > 행 선반 / 매출 필드 > 더블클릭    
2. 마크 선반 매출 > 퀵 테이블 계산 > 순위    
3. 마크 선반 매출 세모 표시 클릭 > 다음을 사용하여 계산 > 패널(옆에서 아래로) 
4. 데이터 패널에서 매출 더블클릭 > 퀵테이블 > 구성비율 > 다음을 사용하여 계산 > 패널(아래로)  

- 매출이 많은 고객/ 적은 고객
1. 고객이름 > 행선반 / 매출 더블클릭    
2. 마크 선반 매출 마우스 우클릭 > 퀵 테이블 계산 > 백분위수 
3. 상단 툴바 내림차순/오름차순 정리   

## 38. 퀵테이블계산(2)
- 이동 평균    
이전의 값부터 현재까지 값에 대한 평균을 낼 때 사용하며 주식 데이터에서 많이 사용.
> 1. 연속형 "분기(주문 날짜)"> 열선반/ 매출 > 행선반
  2. 매출 복제 > 매출 마우스 우클릭 > 퀵 테이블 계산 > 이동평균 선택 
  3. 매출 + 컨트롤 > 마크 레이블 위로 > 매출 우클릭 > 테이블 계산 편집 > 평균(이전2, 현재0)   
  4. 그래프 좌측 우클릭 > 이중축 / 그래프 좌측 우클릭 > 축 동기화   

- YTD 
특정 시점을 기준으로 해당 연도부터 그 시점까지 총계   
기본적으로 '누계'와 같은 개념이지만 '연도'보다 하위레벨 필드인 '분기' 또는 '월'이 있어야 사용가능.   
> 1. 주문 날짜 > 행선반 > 년 월만 표시 / 매출 더블클릭 > 년/월별 매출 합계 표시 
  2. 마크카드의 매출 필드에 마우스 우클릭 > 퀵테이블 계산 > YTD 총계 선택 
  3. 측정값 매출 더블 클릭 > YTD 총계가 맞게 들어간 것을 확인   

- 통합 성장률    
> 1. 주문 날짜 필드 > 행선반 > 년 분기만 표시 / 매출 더블클릭 > 년/월별 매출 합계 표시    
  2. 마크 카드에 매출 필드에 마우스 우클릭 > 퀵테이블 계산 > 통합 성장률 선택     

- 전년 대비 성장률 
> 1. 주문 날짜 필드 > 행선반 > 년분기만 표시 / 매출 더블 클릭 > 년/월별 매출 합계 표시   
  2. 마크카드 매출 필드에 마우스 우클릭 > 퀵 테이블 계산 > 전년 대비 성장률 선택       
  
- YTD 성장률   
> 1. 주문 날짜 필드 > 행선반 > 년분기만 표시 / 매출 더블 클릭 > 년/월별 매출 합계 표시     
  2. 마크카드 매출 필드에 마우스 우클릭 > 퀵 테이블 계산 > YTD성장률 선택     
  3. 해당 성장률 값 검증 위해 매출 더블 클릭해주고 측정값 카드에 있는 퀵테이블 계산이 적용된 매출 필드를 더블 클릭 > 동작을 완료할 수 없다는 에러 > 에러 발생 이유 : 단일 계산식이 아니기 때문   
  이를 확인하기 위해 측정값 카드에 있는 합계 매출을 컨트롤 키 누른 상태로 데이터 패널로 던진다.  
  계산1 필드 => YTD 총계로 
  계산1 1 필드 => YTD 성장률로    
  YTD 총계 필드를 측정값 가운데로 넣어줌    
   

## 문제 1.

규석이는 이제껏 매출을 올리는 데에 힘썼었지만, 왠지 모르게 주머니에 들어오는 돈이 없어 속상합니다. 

그래서 매출이 상위 20곳에 속하지만, 수익률(%)이 마이너스인 시/도를 확인하려고 합니다.

> 수익률은 SUM([수익]) / SUM([매출])로 정의합니다.

어떤 집합을 만들었고, 어떤 결합을 하였는지를 중심으로 기술하고, 결과 자료를 첨부해주세요. 

(텍스트 표 형태이며, 색상으로 위 집합을 구분할 수 있게 만들어주세요.)

<!-- 아래 예시 이미지를 삭제하고, 직접 만든 시트 사진을 올려주세요. 시트의 이름은 본인 이름으로 기입해주세요-->

![image](../tableau/image/image%20copy%203.png)
1. 상위 20 집합 만들기
2. 수익률 마이너스 집합 만들기 
3. 교집합 만들기 


## 문제 2.
선희는 주문 Id별로 주문에서 배송까지에 걸리는 날짜 일수가 궁금했습니다. 
그래서 주문 ID별로 주문에서 배송까지 걸리는 일자를 '배송까지 걸린 일수'라는 계산된 필드로 만들고, 이를 마크에 올린 후 확인해보았습니다. 
이때, 계산된 필드의 식은 'DATEDIFF' 함수를 이용하였습니다.

배송까지 걸린 일수 계산을 위한 DATEDIFF 함수 수식을 적어주세요.

```
- DATEDIFF
datediff(날짜_부분, 시작_날짜, 끝_날짜 [주_시작])     
datediff('day', [주문 날짜], [배송 날짜]) 
```
![image](../tableau/image/image%20copy%204.png)

![image](../tableau/image/image%20copy%205.png)

![datediff](https://github.com/yousrchive/BUSINESS-INTELLIGENCE-TABLEAU/blob/main/study/img/4th%20til/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202024-09-30%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%203.47.21.png?raw=true)

그런데 위 그림처럼 '주문 날짜'와 '배송 날짜'를 함께 행에 올려 확인해보니, 주문날짜와 배송날짜의 차이가 '배송까지 걸린 일수'와 다릅니다.

ID-2021-11126을 보니, 11월 26일 배송에 11월 30일 배송이면 4일 차이인데, 12일이 걸렸다고 하네요. 왜 이런 문제가 생긴걸까요?

```
어떤 주문 id들이 여러개의 제품 레코드를 가지고 있어서 계산된 필드에서 일수를 전부 합계해 버리기 때문에 
```

그리고 이를 해결하기 위해서는 어떻게 해야 할까요?

```
해당 필드를 측정값에서 차원값으로 변경해서 사용해야 합니다. 
```


## 문제 3.

다음은 Tableau의 다양한 계산을 사용할 수 있는 경우를 빈칸으로 두고 문제를 작성한 것입니다. 각 빈칸에 적합한 계산 유형을 채워보세요.

보기
> **누계, 차이, 비율 차이, 구성 비율, 순위, 백분위수, 이동 평균, YTD 총계, 통합 성장률, 전년 대비 성장률, YTD 성장률**

| 계산 유형               | 설명                                                                 | 사용 예시                                                                                          |
|-------------------------|----------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| 누계           | 데이터의 누적 합계를 계산                                             | 한 기업이 월별 매출 데이터를 누적하여 연간 매출 추이를 보고 싶을 때 사용                                      |
| 차이          | 연속 데이터 포인트 간의 차이를 계산                                    | 한 기업이 월별 매출 데이터에서 전월 대비 매출 증감량을 분석하고 싶은 경우                                        |
|   비율 차이     | 연속 데이터 포인트 간의 비율 변화를 계산                               | 한 기업이 월별 매출 데이터에서 전월 대비 매출 증감률(%)을 분석하고 싶은 경우                                      |
| 구성 비율           | 전체에서 각 데이터 포인트의 비율을 계산                                | 한 기업이 전체 매출에서 각 제품군이 차지하는 비율을 보고 싶을 때 사용                                           |
| 순위          | 데이터의 순위를 매깁니다                                              | 한 기업이 제품별 매출 데이터를 순위별로 정렬하여 상위 10개 제품을 분석하고 싶은 경우                              |
| 백분위수          | 데이터의 백분위를 계산                                               | 한 기업이 고객별 구매 금액 데이터를 백분위수로 나누어 상위 25% 고객을 분석하고 싶은 경우                          |
| 이동 평균           | 일정 기간의 평균을 계산                                               | 한 기업이 주간 매출 데이터에서 4주 이동 평균을 계산하여 트렌드를 분석하고 싶은 경우                              |
| YTD 총계           | 연초부터 현재까지의 총계를 계산                                      | 한 기업이 월별 매출 데이터를 연초부터 현재까지 누적하여 연간 매출 목표 달성 여부를 분석하고 싶은 경우             |
|     통합 성장률     | 일정 기간 동안의 연평균 성장률을 계산                                  | 한 기업이 5년 간 매출 데이터를 바탕으로 연평균 성장률(CAGR)을 계산하고 싶은 경우                                  |
| 전년 대비 성장률          | 전년 동기간 대비 성장률을 계산                                        | 한 기업이 월별 매출 데이터에서 전년 동월 대비 매출 성장률을 분석하고 싶은 경우                                    |
|YTD 성장률          | 연초부터 현재까지의 성장률을 계산                                     | 한 기업이 올해 연초부터 현재까지의 매출이 전년 동기 대비 얼마나 성장했는지 분석하고 싶은 경우                     |

> 사용 예시를 참고하여 실제 경우처럼 생각하며 고민해보아요!